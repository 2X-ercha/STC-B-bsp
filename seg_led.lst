C51 COMPILER V9.51   SEG_LED                                                               10/13/2022 15:06:28 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE SEG_LED
OBJECT MODULE PLACED IN .\dist\seg_led.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\seg_led.c BROWSE DEBUG OBJECTEXTEND PRINT(.\seg_led.lst) TABS(2) OBJECT
                    -(.\dist\seg_led.obj)

line level    source

   1          #include "seg_led.h"
   2          #include <STC15F2K60S2.H>
   3          
   4          // seg & led å¯„å­˜å™¨å¤‡æ³¨è¯´æ˜
   5          /*
   6           * P0: P07 - P00 é«˜ç”µå¹³æœ‰æ•ˆ
   7           * åŠŸèƒ½1ï¼šæ•°ç ç®¡å•ä¸ªæ®µé€‰
   8           *      ç®¡è„šç¼–ç ä½ï¼šï¼ˆå°æ•°ç‚¹ä¸º8)
   9           *     ----    0
  10           *    |    |     5   1
  11           *     ----      6
  12           *    |    |     4   2
  13           *     ---- -    5   7
  14           *      ç®¡è„šå¯¹åº”å¯„å­˜å™¨å³ä¸º P00 - P07
  15           * åŠŸèƒ½2: ledç¯é€‰æ‹©ï¼ˆåˆšå¥½8ä¸ªï¼Œä»å·¦å¾€å³ P07 - P00 ï¼‰
  16           * 
  17           * P2:
  18           *  P22 - P20
  19           *      é€‰æ‹©ç¬¬nä¸ªæ•°ç ç®¡ç‚¹äº®ï¼ˆé«˜é€Ÿå¾ªç¯æ¥å®Œæˆè§†è§‰æš‚ç•™ï¼‰
  20           *  P23 ï¼ˆæ³¨ E3 è¿æ¥åˆ°æ•°ç ç®¡ä¸­ï¼‰
  21           *      è®¾ä¸º0åˆ™æ•°ç ç®¡æ˜¾ç¤ºï¼Œè®¾ä¸º1åˆ™ledæ˜¾ç¤º
  22           */
  23          /*
  24           * æ¨æŒ½ç­‰å¯„å­˜å™¨åˆå§‹åŒ–ç›¸å…³
  25           * P0: ï¼ˆèŠ¯ç‰‡æ•°æ®æ‰‹å†Œ p324ï¼‰
  26           *  ä¾‹å¦‚ï¼šï¼ˆ00ï¼šå‡†åŒå‘å£    01ï¼šæ¨æŒ½è¾“å‡º    10ï¼šä»…ä¸ºè¾“å…¥    11ï¼šå¼€æ¼ï¼ˆå¯è¯»å¯å†™ï
             -¼‰
  27           *          P07     P06     P05     P04     P03     P02     P01     P00
  28           *  P0M1:   1       0       1       0       0       0       0       0
  29           *  P0M0:   1       1       0       0       0       0       0       0
  30           *          å¼€æ¼    æ¨æŒ½    è¾“å…¥     å‡†åŒå‘    
  31           * 
  32           * P2: ï¼ˆèŠ¯ç‰‡æ•°æ®æ‰‹å†Œ p323ï¼‰
  33           *  åŒä¸Š
  34           * è¿™é‡Œå¯¹äºsegå’Œledè€Œè¨€ï¼Œæ˜¾ç„¶åªéœ€è¦è®¾ä¸ºæ¨æŒ½è¾“å‡ºå³å¯
  35           */
  36          
  37          data unsigned char seg_display_buf[8] = {0,0,0,0,0,0,0,0};   // å­˜å‚¨å„ä¸ªæ•°ç ç®¡æ˜¾ç¤ºä½çš„å…·ä½“å€¼
  38          data unsigned char led_display_buf = 0;      // å­˜å‚¨ledæ˜¾ç¤ºå€¼
  39          data unsigned char display_pos = 0;
  40          
  41          void Seg_Led_Init(){
  42   1          // P0ã€P2å£å…¨éƒ¨è®¾ä¸ºæ¨æŒ½è¾“å‡º
  43   1          P0M1 = 0x00;
  44   1          P0M0 = 0xff;
  45   1          P2M1 &= 0xf0;
  46   1          P2M0 |= 0x0f;
  47   1      }
  48          
  49          void OneSeg_Print(unsigned char num, unsigned char displaychar){
  50   1          /*
  51   1           * description:
  52   1           *  å•å­—ç¬¦æ•°ç ç®¡æ˜¾ç¤ºä¿®æ”¹
  53   1           * parameter:
C51 COMPILER V9.51   SEG_LED                                                               10/13/2022 15:06:28 PAGE 2   

  54   1           *  num: ä¿®æ”¹çš„ç›®æ ‡æ•°ç ç®¡ç¼–å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸º 0-7
  55   1           *  displaychar: ä¿®æ”¹åæ˜¾ç¤ºçš„å­—ç¬¦ 
  56   1           */
  57   1          seg_display_buf[num] = displaychar;
  58   1      }
  59          
  60          void AllSeg_Print(unsigned char* displaychars){
  61   1          /*
  62   1           * description:
  63   1           *  8ä½æ•°ç ç®¡å…¨æ˜¾ç¤ºä¿®æ”¹
  64   1           * parameter:
  65   1           *  displaychars: æ˜¾ç¤ºå­—ç¬¦çš„ç¼–ç æ•°ç»„ï¼Œé•¿åº¦ä¸º8
  66   1           */
  67   1          seg_display_buf[7] = displaychars[7];
  68   1          seg_display_buf[6] = displaychars[6];
  69   1          seg_display_buf[5] = displaychars[5];
  70   1          seg_display_buf[4] = displaychars[4];
  71   1          seg_display_buf[3] = displaychars[3];
  72   1          seg_display_buf[2] = displaychars[2];
  73   1          seg_display_buf[1] = displaychars[1];
  74   1          seg_display_buf[0] = displaychars[0];
  75   1      }
  76          
  77          void Led_Print(unsigned char displaychar){
  78   1          led_display_buf = displaychar;
  79   1      }
  80          
  81          void display_pos_next(){
  82   1          /* è¯¥å‡½æ•°åº”è¯¥è¢«å†™å…¥è°ƒåº¦ï¼Œä¸å¯¹å¤–æä¾›api */
  83   1          if(display_pos < 7)
  84   1              display_pos ++;
  85   1          else
  86   1              display_pos = 0;
  87   1      }
  88          
  89          void segled_display(){
  90   1          P23 = ~P23;
  91   1          if(P23 == 0){
  92   2              P0 = seg_display_buf[display_pos];
  93   2              P20 = display_pos & 0x1;
  94   2              P21 = (display_pos & 0x2) >> 1;
  95   2              P22 = (display_pos & 0x4) >> 2;
  96   2          }
  97   1          else{
  98   2              P0 = led_display_buf;
  99   2          }
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    144    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
