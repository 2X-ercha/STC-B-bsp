C51 COMPILER V9.51   MAIN                                                                  10/13/2022 00:17:01 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\dist\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\main.lst) TABS(2) OBJECT(.\dis
                    -t\main.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #include <math.h>
   3          #include <intrins.h>    // å›ºæœ‰å‡½æ•°
   4          #include <absacc.h>     // è®¿é—®ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ï¼ˆå¯èƒ½ç”¨ä¸åˆ°ï¼‰
   5          #include <stdio.h>      // åŠ¨æ€åˆ†é…å†…å­˜å‡½æ•°
   6          #include <stdlib.h>     // æ ‡å‡†åº“
   7          
   8          // ä»¥ä¸Šç”¨ä¸ç”¨çš„åˆ°ä¸çŸ¥é“ï¼Œåæ­£å…ˆæ”¾ç€
   9          
  10          // debug
  11          unsigned char ledtest = 0x0f;
  12          unsigned char leftbit = 0;
  13          
  14          // seg & led å¯„å­˜å™¨å¤‡æ³¨è¯´æ˜
  15          /*
  16           * P0: P07 - P00 é«˜ç”µå¹³æœ‰æ•ˆ
  17           * åŠŸèƒ½1ï¼šæ•°ç ç®¡å•ä¸ªæ®µé€‰
  18           *      ç®¡è„šç¼–ç ä½ï¼šï¼ˆå°æ•°ç‚¹ä¸º8)
  19           *     ----    0
  20           *    |    |     5   1
  21           *     ----      6
  22           *    |    |     4   2
  23           *     ---- -    5   7
  24           *      ç®¡è„šå¯¹åº”å¯„å­˜å™¨å³ä¸º P00 - P07
  25           * åŠŸèƒ½2: ledç¯é€‰æ‹©ï¼ˆåˆšå¥½8ä¸ªï¼Œä»å·¦å¾€å³ P07 - P00 ï¼‰
  26           * 
  27           * P2:
  28           *  P22 - P20
  29           *      é€‰æ‹©ç¬¬nä¸ªæ•°ç ç®¡ç‚¹äº®ï¼ˆé«˜é€Ÿå¾ªç¯æ¥å®Œæˆè§†è§‰æš‚ç•™ï¼‰
  30           *  P23 ï¼ˆæ³¨ E3 è¿æ¥åˆ°æ•°ç ç®¡ä¸­ï¼‰
  31           *      è®¾ä¸º0åˆ™æ•°ç ç®¡æ˜¾ç¤ºï¼Œè®¾ä¸º1åˆ™ledæ˜¾ç¤º
  32           */
  33          
  34          /*
  35           * æ¨æŒ½ç­‰å¯„å­˜å™¨åˆå§‹åŒ–ç›¸å…³
  36           * P0: ï¼ˆèŠ¯ç‰‡æ•°æ®æ‰‹å†Œ p324ï¼‰
  37           *  ä¾‹å¦‚ï¼šï¼ˆ00ï¼šå‡†åŒå‘å£    01ï¼šæ¨æŒ½è¾“å‡º    10ï¼šä»…ä¸ºè¾“å…¥    11ï¼šå¼€æ¼ï¼ˆå¯è¯»å¯å†™ï
             -¼‰
  38           *          P07     P06     P05     P04     P03     P02     P01     P00
  39           *  P0M1:   1       0       1       0       0       0       0       0
  40           *  P0M0:   1       1       0       0       0       0       0       0
  41           *          å¼€æ¼    æ¨æŒ½    è¾“å…¥     å‡†åŒå‘    
  42           * 
  43           * P2: ï¼ˆèŠ¯ç‰‡æ•°æ®æ‰‹å†Œ p323ï¼‰
  44           *  åŒä¸Š
  45           * è¿™é‡Œå¯¹äºsegå’Œledè€Œè¨€ï¼Œæ˜¾ç„¶åªéœ€è¦è®¾ä¸ºæ¨æŒ½è¾“å‡ºå³å¯
  46           */
  47          
  48          unsigned char seg_display_buf[8] = {0,0,0,0,0,0,0,0};    // å­˜å‚¨å„ä¸ªæ•°ç ç®¡æ˜¾ç¤ºä½çš„å…·ä½“å€¼
  49          unsigned char led_display_buf = 0;                       // å­˜å‚¨ledæ˜¾ç¤ºå€¼
  50          
  51          unsigned char display_pos = 0;
  52          
  53          void Seg_Led_Init(){
C51 COMPILER V9.51   MAIN                                                                  10/13/2022 00:17:01 PAGE 2   

  54   1          // P0ã€P2å£å…¨éƒ¨è®¾ä¸ºæ¨æŒ½è¾“å‡º
  55   1          P0M1 = 0x00;
  56   1          P0M0 = 0xff;
  57   1          P2M1 &= 0xf0;
  58   1          P2M0 |= 0x0f;
  59   1      }
  60          
  61          void OneSeg_Print(unsigned char num, unsigned char displaychar){
  62   1          /*
  63   1           * description:
  64   1           *  å•å­—ç¬¦æ•°ç ç®¡æ˜¾ç¤ºä¿®æ”¹
  65   1           * parameter:
  66   1           *  num: ä¿®æ”¹çš„ç›®æ ‡æ•°ç ç®¡ç¼–å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸º 0-7
  67   1           *  displaychar: ä¿®æ”¹åæ˜¾ç¤ºçš„å­—ç¬¦ 
  68   1           */
  69   1          seg_display_buf[num] = displaychar;
  70   1      }
  71          
  72          void AllSeg_Print(unsigned char* displaychars){
  73   1          /*
  74   1           * description:
  75   1           *  8ä½æ•°ç ç®¡å…¨æ˜¾ç¤ºä¿®æ”¹
  76   1           * parameter:
  77   1           *  displaychars: æ˜¾ç¤ºå­—ç¬¦çš„ç¼–ç æ•°ç»„ï¼Œé•¿åº¦ä¸º8
  78   1           */
  79   1          seg_display_buf[7] = displaychars[7];
  80   1          seg_display_buf[6] = displaychars[6];
  81   1          seg_display_buf[5] = displaychars[5];
  82   1          seg_display_buf[4] = displaychars[4];
  83   1          seg_display_buf[3] = displaychars[3];
  84   1          seg_display_buf[2] = displaychars[2];
  85   1          seg_display_buf[1] = displaychars[1];
  86   1          seg_display_buf[0] = displaychars[0];
  87   1      }
  88          
  89          void Led_Print(unsigned char displaychar){
  90   1          led_display_buf = displaychar;
  91   1      }
  92          
  93          void display_pos_next(){
  94   1          /* è¯¥å‡½æ•°åº”è¯¥è¢«å†™å…¥è°ƒåº¦ï¼Œä¸å¯¹å¤–æä¾›api */
  95   1          if(display_pos < 7)
  96   1              display_pos ++;
  97   1          else
  98   1              display_pos = 0;
  99   1      }
 100          
 101          void segled_display(){
 102   1          P23 = ~P23;
 103   1          if(P23 == 0){
 104   2              P0 = seg_display_buf[display_pos];
 105   2              P20 = display_pos & 0x1;
 106   2              P21 = (display_pos & 0x2) >> 1;
 107   2              P22 = (display_pos & 0x4) >> 2;
 108   2          }
 109   1          else{
 110   2              P0 = led_display_buf;
 111   2          }
 112   1      }
 113          
 114          #define MAIN_Fosc       11059200L
 115          #define Main_Fosc_KHZ (MAIN_Fosc / 1000)
C51 COMPILER V9.51   MAIN                                                                  10/13/2022 00:17:01 PAGE 3   

 116          #define TIMESLICE_MS  1
 117          #define Fosc_1ms        (65536 - MAIN_Fosc*TIMESLICE_MS/12/1000)
 118          
 119          unsigned int timer_count = 0;
 120          
 121          void Timer0_Init(){
 122   1          // p498
 123   1          timer_count = 0;
 124   1          TR0 = 0;    // åœæ­¢timer0
 125   1          TMOD &= 0xF0;   // timer0 modeè®¾ç½®ä¸º(xxxx0000b, .3:0 æ‰“å¼€å®šæ—¶/è®¡æ•°å™¨ .2:0 é€‰æ‹©å®šæ—¶æ¨¡å¼
             - .1-0:00 16ä½è‡ªåŠ¨é‡è£…å®šæ—¶å™¨)
 126   1          AUXR &= 0x7F;   // å®šæ—¶å™¨0ç”¨ä¼ ç»Ÿ8051é€Ÿåº¦ï¼Œ12åˆ†é¢‘ï¼ˆï¼Ÿï¼‰
 127   1          TH0 = (Fosc_1ms & 0xff00) >> 8;  TL0 = Fosc_1ms & 0xff;     // è®¾ç½®å®šæ—¶å™¨
 128   1          ET0 = EA = 1;   // å¯ç”¨timer0ä¸­æ–­
 129   1        PT0 = 1;    // è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼ˆåœ¨C51ä¸­timer0æœ¬èº«ä¼˜å…ˆçº§ä¸ºç¬¬äºŒï¼Œè®¾ä¸º1åŸºæœ¬ä¸Šæ˜¯æœ€é«˜äº†ï
             -¼‰
 130   1        TR0 = 1;        // å¯ç”¨timer0
 131   1      }
 132          
 133          void Timer0_Rountine() interrupt 1{
 134   1          if(P23 == 1)
 135   1              display_pos_next();
 136   1          segled_display();
 137   1      
 138   1          if(timer_count % 10 == 0){}
 139   1          if(timer_count % 100 == 0){
 140   2              // æµæ°´ç¯æµ‹è¯•
 141   2              leftbit = (ledtest >> 7) & 1;
 142   2              ledtest <<= 1;
 143   2              ledtest |= leftbit;
 144   2              Led_Print(ledtest);
 145   2          }
 146   1          if(timer_count == 0){}
 147   1      
 148   1          timer_count ++;
 149   1          if(timer_count >= 1000)
 150   1              timer_count = 0;
 151   1          // TH0 = (Fosc_1ms & 0xff00) >> 8;  TL0 = Fosc_1ms & 0xff;     // é‡ç½®å®šæ—¶å™¨ï¼ˆ16ä½è‡ªåŠ¨é‡è½½ä
             -º†ï¼Œä¸éœ€è¦ æ–‡æ¡£P499
 152   1      }
 153          
 154          unsigned char hello[8] = {0x76, 0x79, 0x38, 0x38, 0x5c, 0, 0, 0};
 155          
 156          int main(){
 157   1          Seg_Led_Init();
 158   1          Timer0_Init();
 159   1          AllSeg_Print(hello);
 160   1          Led_Print(0);
 161   1      
 162   1          while(1);
 163   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    302    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.51   MAIN                                                                  10/13/2022 00:17:01 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
